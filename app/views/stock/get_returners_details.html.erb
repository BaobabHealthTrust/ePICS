<%= javascript_include_tag 'jquery' %>
<script type="text/javascript">

    function load(id) {
        document.getElementById('cover').style.display=''
        document.getElementById('loan_details').style.display=''
        document.getElementById('confirm_buttons').style.display=''
        var table = document.getElementById("borrowed_items");

        while (table.rows.length > 1 )
        {
            table.deleteRow(table.rows.length - 1)
        }

        jQuery.ajax({
            type: "GET",
            dataType: "integer",
            url: "/stock/get_lent_items?id=" + id,
            success: function(data){
                answers = data.responseText
                ans = eval('(' + data +')')

                for (items in ans)
                {
                    var rowCount = table.rows.length;
                    var row = table.insertRow(rowCount);
                    var cell1 = row.insertCell(0);
                    cell1.innerHTML = items;

                    var cell2 = row.insertCell(1);
                    cell2.innerHTML = ans[items];
                    cell2.setAttribute('class', 'center')

                }
                table.rows[0].setAttribute('id', id)
            }
        });



    }

    function verify(){

        if (document.getElementById("borrowed_items").rows[0].id == "")
        {
          showMessage("Please select loan being returned");
        }
        else
        {
           window.location="/stock_details/return_index?id=" + document.getElementById("borrowed_items").rows[0].id;
        }
    }

    function hidePopups(){
      /*
      loan_details = document.getElementById('loan_details')
      loan_details.parentNode.removeChild(loan_details)
      confirm_buttons = document.getElementById('confirm_buttons')
      confirm_buttons.parentNode.removeChild(confirm_buttons)
      cover = document.getElementById('cover')
      cover.parentNode.removeChild(cover)*/
        document.getElementById('cover').style.display='none'
        document.getElementById('loan_details').style.display='none'
        document.getElementById('confirm_buttons').style.display='none'
    }
</script>

<style type="text/css">
  td{
      font-size: 30px;

  }
  th{
      font-size: 30px;

  }
  td.center{
      text-align: center;
  }
  tr.even{
      background-color: #87ceeb;
  }
  tr.odd{
      background-color: silver;
  }

  #loan_details table{
      background-color:#FEF6E4;
      color: black;
      font-size: 18pt;
      font-weight: bold;
      left: 10%;
      line-height: 35px;
      position: absolute;
      top: 131px;
      width: 500px;
      border: 1px solid black;
      z-index: 999;
      padding: 0px 20px 70px 20px;
      -moz-user-select:none;
    }
   #cover{
      position: absolute;
      background-color: black;
      width: 100%;
      height: 102%;
      left: 0%;
      top: 0%;
      z-index: 990;
      opacity: 0.5;
    }

    #continue{
      background-color: grey;
      border-bottom: 1px outset #EEEEEE;
      border-style: outset;
      border-top: 1px outset #EEEEEE;
      color: white;
      display: block;
      padding: 10px;
      text-align: center;
      text-decoration: none;
      background-color: rgb(0, 116, 204);
      background-image: -moz-linear-gradient(center top , rgb(0, 136, 204), rgb(0, 85, 204));
      background-repeat: repeat-x;
      font-size: 1.3em;
      left: 24%;
      bottom: -3%;
    }
    #cancel{
      background-color: grey;
      border-bottom: 1px outset #EEEEEE;
      border-style: outset;
      border-top: 1px outset #EEEEEE;
      color: white;
      display: block;
      padding: 10px;
      text-align: center;
      text-decoration: none;
      background-color: rgb(0, 116, 204);
      background-image: -moz-linear-gradient(center top , rgb(0, 136, 204), rgb(0, 85, 204));
      background-repeat: repeat-x;
      font-size: 1.3em;
      left: 10%;
      top: 50%;
    }
    #confirm_buttons{
      position: absolute;
      top:71%;
      left: 40%;
      z-index: 999;
    }
</style>

<div id="cover" style="display: none">

</div>
<div id="loan_details" style="display: none">
  <span style="margin-left: 35%; top: 60%;font-size: 25px;font-weight: bold;">Loaned Items from <u><%= session[:item_returns][:lent_to] %></u></span>

  <div style="margin:0.5%; border: 1px solid black; height: 40%;width: 99%;overflow: auto">
     <table style="width: 80%;padding: 2px; cell-spacing:4px;" id="borrowed_items">
       <tr><th style="text-align: left">Product</th> <th>Borrowed Quantity</th></tr>


     </table>
  </div>
</div>
<span style="margin-left: 0.5; font-size: 25px;font-weight: bold;">&nbsp;Dates For Outstanding Loan</span>

  <div style="margin-left:0.5%; border: 1px solid black; height: 83%;width: 99%; overflow: auto">

    <table style="width: 100%;padding: 2px; cell-spacing:4px;">
      <% @dates.each do |x| %>
          <tr class=<%=cycle('even','odd') %>>
            <td onclick="load(<%= x[1] %>)" > <%= x[0].strftime("%a, %d-%B-%Y") %></td>
          </tr>
      <% end %>
    </table>

  </div>

<div id="confirm_buttons" style="display:none">
  <table>
    <tr>
      <td><a id="cancel" onclick="hidePopups();"><span>Cancel</span></a></td>
      <td width="100px">&nbsp;</td>
      <td><a id="continue" onclick="verify()"><span>Continue</span></a></td>
    </tr>
  </table>
</div>




<div id="buttons" class="buttonsDiv">
  <button class="red" onclick="window.location= '/'"><span>Cancel</span></button>
  <button style="float: right;"class="green" onclick="verify()"><span>Finish</span></button>
  <button style="float: right;" onclick="window.location='/stock/receive_loan_returns'"><span>Back</span></button>
</div>