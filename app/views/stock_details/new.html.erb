<script type='text/javascript'><!--

	tt_cancel_show='/stock/new'
	tt_cancel_destination='/stock/new'

        function set_ajaxURL_for_suggestions(value) {
          url = "/product/get_products?product_category_id=" + value ;
          $('touchscreenInput'+tstCurrentPage).setAttribute('ajaxURL', url);
          listSuggestions(tstCurrentPage);
       }

       function ajaxRequest(control, url){
           var httpRequest = new XMLHttpRequest();
            httpRequest.onreadystatechange = function() {
                handleAjaxRequest(control, httpRequest);
            };
            try {
                httpRequest.open('GET', url, true);
                httpRequest.send(null);
            } catch(e){
            }
        }

        function handleAjaxRequest(control, aXMLHttpRequest) {
          if (!aXMLHttpRequest) return;

          if (aXMLHttpRequest.readyState == 4 && aXMLHttpRequest.status == 200) {

              var result = aXMLHttpRequest.responseText;
              
              if (control != null){
                control.innerHTML = result;
              } else {
                eval(result);

                window.location.reload();
              }
          }

        }

        function showExpiryDate(value) {
          v =  value;
          alert(v);
        }

//-->
</script>

<%= form_tag :action => 'create', :method => :post  do %>

 <%= select_tag "stock_details[location_id]", options_for_select(@locations_map),
    {:id => "stock_details_location_id",:field_type => 'alpha',
    :helpText => "Select Item Location"} %>

<%= select_tag "stock_details[product_category_id]", options_for_select(@product_category_map),
      { :id => "product_category_id",
        :field_type => 'alpha',
        :tt_BeforeUnLoad => 'showExpiryDate(ajaxRequest(null, "/product/expire?product_name=" + $("product_category_id").value));',
        :helpText => "Select Item Category"} %>

  <%= select_tag "stock_details[product_name]", nil,
      {:id => "product_name",
      :field_type => 'alpha',
      :tt_onLoad => 'set_ajaxURL_for_suggestions($("product_category_id").value);',
      :helpText => "Select Item"} %>


  <%= text_field_tag "stock_details[expire]", nil,
    {:id => "product_expire",
     :field_type => 'date',
     :helpText => "Product Expiry Date"} %>

  <%= text_field_tag "stock_details[quantity]", nil,
       {:id => 'product_quantity', :field_type => 'number',
        :helpText => 'Enter Product Quantity'} %>

  <%= submit_tag "Create Stock Details" %>


<% end %>